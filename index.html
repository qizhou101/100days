<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘ä»¬çš„100å¤©çºªå¿µæ—…ç¨‹ (ç§»åŠ¨ç«¯ä¼˜åŒ–ç‰ˆ V4) ğŸ› ï¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

    <style>
        /* --- å…¨å±€æ ·å¼ (ç§»åŠ¨ç«¯æ ¸å¿ƒ) --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html {
            margin: 0; padding: 0; overflow: hidden; 
            background-color: #ffffff; 
            font-family: 'PingFang SC', -apple-system, BlinkMacSystemFont, Roboto, Helvetica, sans-serif;
            height: 100%; width: 100%;
            position: fixed; /* é”å®šå±å¹• */
        }
        #container { width: 100%; height: 100%; position: relative; }
        .stage {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; 
            justify-content: center; /* å‚ç›´å±…ä¸­ */
            align-items: center; /* æ°´å¹³å±…ä¸­ */
            opacity: 0; pointer-events: none;
            padding: 20px; /* é˜²æ­¢å†…å®¹è´´è¾¹ */
        }

        /* --- å¯åŠ¨é¡µ --- */
        #start-screen { background: #ffffff; z-index: 999; opacity: 1; pointer-events: auto; }
        #start-btn {
            padding: 15px 40px; border: 2px solid #ff4757; color: #ff4757; font-size: 1.1rem;
            cursor: pointer; border-radius: 50px; margin-top: 30px; letter-spacing: 1px;
            background: transparent; font-weight: bold;
        }

        /* --- Stage 1: å€’è®¡æ—¶/100å¤© --- */
        #stage-particles { background: #ffffff; }
        #countdown-timer {
            position: absolute; color: #333; font-size: 12vw; /* ä½¿ç”¨è§†çª—å•ä½é€‚é… */
            font-weight: 300; font-family: 'Courier New', monospace;
        }
        .time-label { font-size: 1rem; color: #999; letter-spacing: 2px; margin-top: 10px; display: block; text-align: center;}
        #final-100-text { 
            position: absolute; color: #ff4757; font-size: 15vw; opacity: 0; font-weight: bold;
        }

        /* --- Stage 2: èœ¡ç¬”å°æ–° --- */
        #shinchan-img { width: 70%; max-width: 300px; margin-bottom: 3vh; }
        .dialogue-box {
            background: #fff; color: #333; padding: 15px 20px; border-radius: 15px;
            font-size: 1rem; position: relative; max-width: 90%; opacity: 0;
            border: 1px solid #eee; box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        .dialogue-box::after {
            content: ''; position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            border-width: 0 10px 10px; border-style: solid; border-color: #fff transparent; display: block;
        }

        /* --- Stage 3: èƒ¶å·å¿«é—ª --- */
        #film-roll-container { width: 100%; height: 100%; background: #fff; display: flex; align-items: center; justify-content: center; }
        /* ç¡®ä¿å›¾ç‰‡æŒ‰æ¯”ä¾‹æ˜¾ç¤ºå®Œæ•´ */
        .film-img { width: auto; height: auto; max-width: 95%; max-height: 95%; object-fit: contain; position: absolute; opacity: 0; }

        /* --- Stage 4: ç…§ç‰‡ç”»å»Š (ç§»åŠ¨ç«¯é‡æ„) --- */
        .gallery-slide {
            position: absolute; width: 100%; height: 100%; 
            display: flex; flex-direction: column;
            /* ä¸Šä¸‹åˆ†å¸ƒï¼šä¸Šé¢æ”¾å›¾ï¼Œä¸‹é¢æ”¾å­— */
            justify-content: space-between; 
            align-items: center; opacity: 0;
            padding: 20px 0 40px 0; /* ä¸Šä¸‹ç•™ç™½ */
        }
        /* ç…§ç‰‡å®¹å™¨ï¼šå æ®ä¸Šæ–¹å¤§éƒ¨åˆ†ç©ºé—´ */
        .photo-group-container {
            flex: 1; /* å æ»¡å‰©ä½™ç©ºé—´ */
            width: 100%;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .photo-group { 
            display: flex; flex-wrap: wrap; justify-content: center; align-items: center; 
            gap: 10px; width: 100%; height: 100%;
        }
        /* ç…§ç‰‡æ ·å¼ï¼šæ ¸å¿ƒä¿®æ”¹ */
        .photo-group img { 
            /* è®©å›¾ç‰‡å°½å¯èƒ½å¤§ï¼Œä½†ä¸è¶…è¿‡å±å¹•ï¼Œä¸”æ˜¾ç¤ºå®Œæ•´ */
            width: auto; height: auto;
            max-width: 90%; max-height: 60vh; /* æœ€å¤§é«˜åº¦ä¸è¶…è¿‡å±å¹•çš„60% */
            object-fit: contain; /* ä¿è¯ç…§ç‰‡æ˜¾ç¤ºå®Œæ•´ï¼Œä¸è£åˆ‡ */
            border-radius: 8px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        /* å¦‚æœä¸€ç»„æœ‰å¤šå¼ å›¾ï¼Œè®©å®ƒä»¬ç¨å¾®å°ä¸€ç‚¹ä»¥ä¾¿æ’å¸ƒ */
        .photo-group.multi-photos img { max-height: 40vh; max-width: 45%; }

        /* å­—å¹•æ ·å¼ */
        .caption { 
            font-size: 1.2rem; text-align: center; width: 90%; 
            font-weight: bold; letter-spacing: 1px; line-height: 1.5; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            /* é¢œè‰²ä¼šç”±JSéšæœºç”Ÿæˆ */
            transition: color 0.5s;
            padding: 10px; background: rgba(255,255,255,0.9); border-radius: 10px; /* åŠ ä¸ªèƒŒæ™¯é˜²æ­¢çœ‹ä¸æ¸… */
        }

        /* --- Stage 5: è§†é¢‘çˆ±å¿ƒå¢™ --- */
        #video-heart-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(3, 1fr);
            gap: 3px; width: 98%; aspect-ratio: 4/3; position: relative;
        }
        /* ç¡®ä¿è§†é¢‘å¡«æ»¡æ ¼å­ */
        .video-item { width: 100%; height: 100%; object-fit: cover; border-radius: 4px; opacity: 0; display: block; background: #000;}
        .v-pos-1 { grid-area: 1 / 2 / 2 / 3; }
        .v-pos-2 { grid-area: 1 / 3 / 2 / 4; }
        .v-pos-3 { grid-area: 2 / 1 / 3 / 2; }
        .v-pos-4 { grid-area: 2 / 2 / 3 / 3; }
        .v-pos-5 { grid-area: 2 / 3 / 3 / 4; }
        .v-pos-6 { grid-area: 2 / 4 / 3 / 5; }
        .v-pos-7 { grid-area: 3 / 2 / 4 / 4; justify-self: center; width: 100%; } /* ä¿®æ­£æœ€ä¸‹é¢è§†é¢‘å®½åº¦ */

        .heart-center-text {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #ff4757; background: rgba(255,255,255,0.9);
            padding: 15px 10px; border-radius: 10px; font-size: 1rem; text-align: center; width: 80%; z-index: 10;
            opacity: 0; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* --- Stage 6: ç»“å°¾ --- */
        #final-message {
            color: #333; font-size: 1.4rem; line-height: 2; text-align: center; width: 85%; opacity: 0; letter-spacing: 2px; font-weight: 300;
        }
    </style>
</head>
<body>
    <audio id="bgm1" src="music1.mp3" preload="auto"></audio>
    <audio id="bgm2" src="music2.mp3" preload="auto" loop></audio>
    <audio id="shinchan-voice" src="shinchan.mp3" preload="auto"></audio>

    <div id="container">
        <div id="start-screen" class="stage" style="opacity: 1; pointer-events: auto;">
            <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ¬</div>
            <h1>æ’ç»ƒæ¨¡å¼ V4</h1>
            <p style="color:#999; font-size: 0.9rem;">ä¼˜åŒ–ç§»åŠ¨ç«¯å¸ƒå±€ä¸è§†é¢‘æ’­æ”¾</p>
            <div id="start-btn">å¼€å§‹è°ƒè¯•</div>
        </div>

        <div id="stage-particles" class="stage">
            <div id="particles-js"></div>
            <div id="countdown-timer">00:00:00</div>
            <div id="final-100-text">100 DAYS</div>
        </div>

        <div id="stage-shinchan" class="stage">
            <img id="shinchan-img" src="shinchan.png" alt="å°æ–°å›¾ç‰‡æŒ‚äº†">
            <div class="dialogue-box">å’Œæˆ‘ä¸€èµ·ä½“éªŒè¿™æ¬¡é€†è½¬æ—¶é—´çš„æ—…ç¨‹å§ï¼</div>
        </div>

        <div id="stage-filmroll" class="stage">
            <div id="film-roll-container">
                <img class="film-img" src="p1_1.jpg" alt="å¿«é—ªå›¾p1_1æŒ‚äº†">
                <img class="film-img" src="p2_1.jpg" alt="å¿«é—ªå›¾p2_1æŒ‚äº†">
                <img class="film-img" src="p4_1.jpg" alt="å¿«é—ªå›¾p4_1æŒ‚äº†">
                <img class="film-img" src="p6_1.jpg" alt="å¿«é—ªå›¾p6_1æŒ‚äº†">
                <img class="film-img" src="p7_1.jpg" alt="å¿«é—ªå›¾p7_1æŒ‚äº†">
            </div>
        </div>

        <div id="stage-gallery" class="stage">
            <div class="gallery-slide">
                <div class="photo-group-container">
                    <div class="photo-group multi-photos">
                        <img src="p1_1.jpg" alt="p1_1æŒ‚äº†"><img src="p1_2.jpg" alt="p1_2æŒ‚äº†"><img src="p1_3.jpg" alt="p1_3æŒ‚äº†">
                    </div>
                </div>
                <div class="caption">è¿™æ˜¯è°å®¶çš„ç¾å¥³å•Šï¼ŒåŸæ¥æ˜¯æˆ‘å®¶çš„å•Šï¼</div>
            </div>
             <div class="gallery-slide">
                <div class="photo-group-container">
                    <div class="photo-group multi-photos">
                        <img src="p2_1.jpg" alt="p2_1æŒ‚äº†"><img src="p2_2.jpg" alt="p2_2æŒ‚äº†">
                    </div>
                </div>
                <div class="caption">æœ‰ç†Šé™ªä¼´çš„äººå°±æ˜¯ä¼šå¾ˆå¹¸ç¦å‘¢</div>
            </div>
            <div class="gallery-slide">
                <div class="photo-group-container">
                    <div class="photo-group">
                        <img src="p3_1.jpg" alt="p3_1æŒ‚äº†">
                    </div>
                </div>
                <div class="caption">ç™¾åƒä¸åŒçš„å·´æ–¯å…‹</div>
            </div>
            <div class="gallery-slide">
                <div class="photo-group-container">
                    <div class="photo-group multi-photos">
                        <img src="p4_1.jpg" alt="p4_1æŒ‚äº†"><img src="p4_2.jpg" alt="p4_2æŒ‚äº†"><img src="p4_3.jpg" alt="p4_3æŒ‚äº†">
                    </div>
                </div>
                <div class="caption">å‡ºå‘ï¼é¦–æ¸¸é½é²</div>
            </div>
            <div class="gallery-slide">
                <div class="photo-group-container">
                    <div class="photo-group">
                        <img src="p5_1.jpg" alt="p5_1æŒ‚äº†">
                    </div>
                </div>
                <div class="caption">å“¼ï¼Œä¸‰æ¬¡å”‰ï¼Œæˆ‘å°±è¿™ä¸€å¼ ç…§ç‰‡ï¼Œä½†ä¹Ÿçæƒœçš„ä¸å¾—äº†å‘¢</div>
            </div>
            <div class="gallery-slide">
                <div class="photo-group-container">
                    <div class="photo-group multi-photos">
                        <img src="p6_1.jpg" alt="p6_1æŒ‚äº†"><img src="p6_2.jpg" alt="p6_2æŒ‚äº†">
                    </div>
                </div>
                <div class="caption">è™½ç„¶è·ç¦»å¾ˆè¿œï¼Œä½†dimoä¼šä»£æ›¿æˆ‘ä¸€ç›´é™ªåœ¨ä½ çš„èº«è¾¹</div>
            </div>
            <div class="gallery-slide">
                <div class="photo-group-container">
                    <div class="photo-group">
                        <img src="p7_1.jpg" alt="p7_1æŒ‚äº†">
                    </div>
                </div>
                <div class="caption">åˆä»£å°è›‹ç³•æ¥äº†</div>
            </div>
        </div>

        <div id="stage-videoheart" class="stage">
            <div id="video-heart-grid">
                <video class="video-item v-pos-1" src="v1.mp4" muted playsinline webkit-playsinline loop></video>
                <video class="video-item v-pos-2" src="v2.mp4" muted playsinline webkit-playsinline loop></video>
                <video class="video-item v-pos-3" src="v3.mp4" muted playsinline webkit-playsinline loop></video>
                <video class="video-item v-pos-4" src="v4.mp4" muted playsinline webkit-playsinline loop></video>
                <video class="video-item v-pos-5" src="v5.mp4" muted playsinline webkit-playsinline loop></video>
                <video class="video-item v-pos-6" src="v6.mp4" muted playsinline webkit-playsinline loop></video>
                <video class="video-item v-pos-7" src="v7.mp4" muted playsinline webkit-playsinline loop></video>
                <div class="heart-center-text">ä½ çš„è¿‡å»æˆ‘æ¥ä¸åŠï¼Œ<br>ä½ çš„æœªæ¥æˆ‘ä»¬ä¸€è¨€ä¸ºå®šâ¤ï¸</div>
            </div>
        </div>

        <div id="stage-finale" class="stage">
            <div id="final-message">è®©æˆ‘ä»¬ä¸€èµ·ç›¸çº¦ï¼Œ<br>åœ¨æœªçŸ¥çš„ä»¥åï¼Œ<br>èº«è¾¹ï¼Œè¿˜æ˜¯å½¼æ­¤ã€‚</div>
        </div>
    </div>


    <script>
        gsap.registerPlugin(TextPlugin);
        const bgm1 = document.getElementById('bgm1');
        const bgm2 = document.getElementById('bgm2');
        const shinchanVoice = document.getElementById('shinchan-voice');
        const videos = document.querySelectorAll('.video-item');

        // --- éšæœºé¢œè‰²è¾…åŠ©å‡½æ•° ---
        function getRandomColor() {
            const colors = ['#ff4757', '#2ed573', '#1e90ff', '#ffa502', '#8e44ad', '#e84393', '#00b894'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // --- é…ç½®åŒºåŸŸ (è°ƒè¯•ç‰ˆï¼šç«‹å³ç»“æŸ) ---
        const TARGET_DATE = new Date().getTime() - 1000;

        // ç²’å­é…ç½®
        particlesJS("particles-js", {
            "particles": {
                "number": { "value": 60 }, /* æ‰‹æœºä¸Šç²’å­å°‘ä¸€ç‚¹ï¼Œæ€§èƒ½å¥½ */
                "color": { "value": ["#ff6b81", "#70a1ff", "#2ed573"] },
                "shape": { "type": "circle" },
                "opacity": { "value": 0.7, "random": true },
                "size": { "value": 4, "random": true },
                "move": { "enable": true, "speed": 3, "direction": "none", "random": true, "out_mode": "out" },
                "line_linked": { "enable": false }
            },
            "interactivity": { "events": { "onclick": { "enable": false }, "onhover": { "enable": false } } }
        });

        let timerInterval;
        const mainTimeline = gsap.timeline({ paused: true });

        // å€’è®¡æ—¶é€»è¾‘
        function updateTimer() {
            const now = new Date().getTime();
            const distance = TARGET_DATE - now;
            if (distance < 0) {
                clearInterval(timerInterval);
                document.getElementById("countdown-timer").innerHTML = ""; // æ¸…ç©ºå€’è®¡æ—¶
                startMainShow();
                return;
            }
            // (è°ƒè¯•æ¨¡å¼ä¸‹ä¸æ˜¾ç¤ºå…·ä½“æ—¶é—´ï¼Œç›´æ¥è·³è¿‡)
        }

        // --- æ ¸å¿ƒä¿®æ”¹ï¼šç‚¹å‡»å¼€å§‹æ—¶çš„å¤„ç† ---
        document.getElementById('start-btn').addEventListener('click', () => {
            // 1. å°è¯•æ¿€æ´»æ‰€æœ‰éŸ³é¢‘å’Œè§†é¢‘ (è§£å†³æ‰‹æœºä¸è‡ªåŠ¨æ’­æ”¾çš„é—®é¢˜)
            bgm1.play().catch(()=>{}); bgm1.pause();
            bgm2.play().catch(()=>{}); bgm2.pause();
            shinchanVoice.play().catch(()=>{}); shinchanVoice.pause();
            videos.forEach(v => { 
                v.play().catch((e)=>{console.log("è§†é¢‘æ’­æ”¾å¤±è´¥ï¼Œå¯èƒ½è·¯å¾„ä¸å¯¹æˆ–æ ¼å¼ä¸æ”¯æŒ", e)}); 
                v.pause(); 
            });

            // 2. å¼€å§‹ç•Œé¢åŠ¨ç”»
            gsap.to('#start-screen', { opacity: 0, duration: 0.8, onComplete: () => {
                document.getElementById('start-screen').style.display = 'none';
                gsap.to('#stage-particles', { opacity: 1, duration: 1 });
                bgm1.play(); // æ’­æ”¾èƒŒæ™¯ä¹1
                updateTimer(); // è§¦å‘å€’è®¡æ—¶ç»“æŸé€»è¾‘
            }});
        });

        function startMainShow() {
            const tl = gsap.timeline();
            // å€’è®¡æ—¶æ–‡å­—æ·¡å‡º
            tl.to('#countdown-timer', { opacity: 0, duration: 0.5 })
              .call(() => {
                  if(window.pJSDom && window.pJSDom[0]) window.pJSDom[0].pJS.particles.move.speed = 40;
              })
              .to('#final-100-text', { opacity: 1, scale: 1.1, duration: 1.5, ease: "elastic.out(1, 0.3)" }, "+=0.1")
              // --- ä¿®æ”¹ï¼šç¼©çŸ­äº†è¿™é‡Œçš„ç­‰å¾…æ—¶é—´åˆ° 1 ç§’ ---
              .to('#stage-particles', { opacity: 0, duration: 1 }, "+=1") 
              .add(playShinchanSequence());
        }

        function playShinchanSequence() {
            const tl = gsap.timeline();
            
            // èœ¡ç¬”å°æ–°
            tl.set('#stage-shinchan', { opacity: 1 })
              .from('#shinchan-img', { y: 200, opacity: 0, duration: 1, ease: "back.out(1.7)" })
              .to('.dialogue-box', { opacity: 1, scale: 1, duration: 0.5 }, "+=0.2")
              .call(() => shinchanVoice.play())
              .to('#stage-shinchan', { opacity: 0, duration: 0.8 }, "+=3.5");

            // èƒ¶å·å¿«é—ª
            tl.set('#stage-filmroll', { opacity: 1 })
            document.querySelectorAll('.film-img').forEach(img => {
                tl.to(img, { opacity: 1, duration: 0.1 }).to(img, { opacity: 0, duration: 0.1 }, "+=0.1");
            });
            tl.set('#stage-filmroll', { opacity: 0 });

            // ç…§ç‰‡ç”»å»Š (å¸¦éšæœºé¢œè‰²å­—å¹•)
            tl.set('#stage-gallery', { opacity: 1, pointerEvents: 'auto' });
            
            const slides = document.querySelectorAll('.gallery-slide');
            slides.forEach((slide, index) => {
                let caption = slide.querySelector('.caption');
                let text = caption.innerText;
                caption.innerText = "";
                // è®¾ç½®ä¸€ä¸ªéšæœºé¢œè‰²
                caption.style.color = getRandomColor();

                let slideTL = gsap.timeline();
                slideTL.to(slide, { opacity: 1, duration: 3, ease: "power1.inOut" }) 
                       .to(caption, { text: text, duration: 2.5, ease: "none" }, "-=1.5")
                       .to(slide, { opacity: 0, duration: 1.5 }, "+=3");

                tl.add(slideTL);
            });

            // è§†é¢‘çˆ±å¿ƒå¢™
            tl.call(() => {
                bgm1.pause();
                bgm2.play(); // åˆ‡æ¢BGM
                // å†æ¬¡å°è¯•æ’­æ”¾è§†é¢‘
                videos.forEach(v => { v.currentTime = 0; v.play(); });
            })
            .set('#stage-gallery', { opacity: 0 })
            .set('#stage-videoheart', { opacity: 1 })
            .to('.video-item', { opacity: 1, duration: 1.5, stagger: 0.2 })
            .to('.heart-center-text', { opacity: 1, duration: 2, ease: "power2.out" }, "+=0.5")
            .to('#stage-videoheart', { opacity: 0, duration: 2 }, "+=6");

            // ç»“å°¾
            tl.set('#stage-finale', { opacity: 1 })
              .from('#final-message', { y: 30, opacity: 0, duration: 3, ease: "power2.out" });

            return tl;
        }
    </script>
</body>
</html>